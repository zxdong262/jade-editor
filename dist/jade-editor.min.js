/**
 * jade-editor
 * @version v0.2.5 - 2015-06-18
 * @link http://jade-editor.org
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){function i(t,e){this.init(t,e)}i.keycodes={keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}},i.prototype.init=function(t,n){var i={indent:"    "},s=n||{};this.dom=e.getElementById(t),this.pre=this.dom.nextSibling||this.dom.nextElementSibling,this.options={},this.options.indent=s.indent||i.indent,this.inited=!0,this.evt()},i.prototype.evt=function(){var t=this,e=t.dom;e.addEventListener("keydown",function(e,n){var s=e.keyCode,l=i.keycodes.keydown[s];l&&t["handleKeyEvt_"+l](e,t.updateSyntax)},!1),e.addEventListener("keyup",function(e,n){var s=e.keyCode,l=i.keycodes.keyup[s];return l?void t["handleKeyEvt_"+l](e,t.updateSyntax):t.updateSyntax()},!1),t.autoGrow()},i.prototype.updateSyntax=function(){var t=this,e=t.dom,n=t.pre;n&&(n.innerHTML=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n.classList.remove("prettyprinted"),prettyPrint())},i.prototype.autoGrow=function(){var t=this.dom;t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+"px")},i.prototype.handleKeyEvt_tab=function(t,e){t.preventDefault();var n=this,i=n.options,s=n.dom,l=s.selectionStart,o=s.selectionEnd,r=s.value,a=r.substring(l,o),u=r.substring(l-1,l);"\n"!==u&&""!==u?s.value=r.substring(0,l)+i.indent+r.substring(o):(a=i.indent+a.replace(/\n/g,"\n"+i.indent),s.value=r.substring(0,l)+a+r.substring(o),s.selectionStart=l===o?l+i.indent.length:l,s.selectionEnd=l===o?l+i.indent.length:l+a.length),e.call(n)},i.prototype.handleKeyEvt_enter=function(t,e){var n=this,i=n.options,s=n.dom,l=s.selectionStart,o=s.selectionEnd,r=s.value,a=r.substring(0,l).split("\n"),u=a.length,c=a[u-2],d=/^( *)/,p=c.match(d),v=p[1];s.value=r.substring(0,l)+v+i.indent+r.substring(o),s.selectionStart=l+v.length+i.indent.length,s.selectionEnd=s.selectionStart,e.call(n)},i.prototype.handleKeyEvt_backspace=function(t,e){var n=this,i=n.options,s=i.indent,l=s.length,o=n.dom,r=o.selectionStart,a=o.selectionEnd,u=o.value,c=u.substring(0,r),d=c.split("\n"),p=d.length,v=d[p-1],g=/^ *$/.test(v),h=r-v.length,y=u.substring(h,r),b=y.length;!g||l>b||(t.preventDefault(),o.value=u.substring(0,h)+y.replace(s,"")+u.substring(a),e.call(n))},i.prototype.handleKeyEvt_open_bracket=function(t,e){var n=this,i=n.options,s=n.dom,l=s.selectionStart,o=s.selectionEnd,r=s.value,a=r.substring(l,o),u=t.shiftKey?"{":"[",c=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return s.value=r.substring(0,l)+u+a+c+r.substring(o),s.selectionStart=l===o?l+1:l,s.selectionEnd=o+(l===o?1:2),e.call(n);var d=!a.length;if(d){var p=r.substring(0,l).split("\n"),v=p.length;a=p[v-1];var g=l-a.length,h=r.substring(0,g)}for(var y=a.split("\n"),b=y.length,E=[],f=new RegExp("^"+i.indent),S=0;b>S;S++)E.push(y[S].replace(f,""));a=E.join("\n"),d?(s.value=h+a+r.substring(o),s.selectionStart=h.length,s.selectionEnd=h.length):(s.value=r.substring(0,l)+a+r.substring(o),s.selectionStart=l,s.selectionEnd=l+(l===o?0:a.length+1)),e.call(n)},i.prototype.handleKeyEvt_close_bracket=function(t,e){return t.ctrlKey?this.handleKeyEvt_tab(t,e):void 0},i.prototype.handleKeyEvt_single_quote=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,l=i.selectionEnd,o=i.value,r=t.shiftKey?'"':"'";t.preventDefault(),i.value=o.substring(0,s)+r+o.substring(s,l)+r+o.substring(l),i.selectionStart=s===l?s+1:s,i.selectionEnd=l+(s===l?1:2),e.call(n)},i.prototype.handleKeyEvt_left_bracket=function(t,e){{var n=this,i=(n.options,n.dom),s=i.selectionStart,l=i.selectionEnd,o=i.value;t.shiftKey?'"':"'"}return t.shiftKey?(t.preventDefault(),i.value=o.substring(0,s)+"("+o.substring(s,l)+")"+o.substring(l),i.selectionStart=s===l?s+1:s,i.selectionEnd=l+(s===l?1:2),void e.call(n)):e.call(n)},i.prototype.handleKeyEvt_i=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,l=i.selectionEnd,o=i.value;return t.ctrlKey?(t.preventDefault(),i.value=o.substring(0,s)+"<i>"+o.substring(s,l)+"</i>"+o.substring(l),i.selectionStart=s===l?s+3:s,i.selectionEnd=l+(s===l?3:7),void e.call(n)):e.call(n)},i.prototype.handleKeyEvt_b=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,l=i.selectionEnd,o=i.value;return t.ctrlKey?(t.preventDefault(),i.value=o.substring(0,s)+"<b>"+o.substring(s,l)+"</b>"+o.substring(l),i.selectionStart=s===l?s+3:s,i.selectionEnd=l+(s===l?3:7),void e.call(n)):e.call(n)},t.JadeEditor=i}(window,document);